<!DOCTYPE html>
<html dir="ltr" lang="en-gb">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />

	<title>Search - loadingreadyrun.com</title>
	<link href="styles/lrr/theme/fonts/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="styles/lrr/theme/fonts/glyphicons-pro-1.9.2/css/glyphicons.css" rel="stylesheet">
	<link href="styles/lrr/theme/stylesheet7712.css?assets_version=4" rel="stylesheet">
	<!--[if lte IE 9]>
		<link href="./styles/lrr/theme/tweaks.css?assets_version=4" rel="stylesheet">
	<![endif]-->
	<style type="text/css">
	progress {
		display: block;
		width: 100%;
	}
	</style>
	<script src="js/elasticlunr.min.js" type="text/javascript"></script>
</head>
<body id="phpbb" class="nojs notouch section-index ltr " data-online-text="Online">
	<div id="background">
		<div id="container">
			<h1 id="header"><a href="https://loadingreadyrun.com/"><img src="img/header.png" width="842" height="63"/></a></h1>
			<div id="navbar">
				<ul><li id="about"><a href="https://loadingreadyrun.com/info/about"><img src="img/navbar-about.gif" width="77" height="16" alt="About"/></a></li><li id="archive"><a href="https://loadingreadyrun.com/videos/archive"><img src="img/navbar-videos.gif" width="93" height="16" alt="Video Archive"/></a></li><li id="live"><a href="https://loadingreadyrun.com/live"><img src="img/navbar-live.gif" width="60" height="14" alt="LoadingReadyLive"/></a></li><li id="blog"><a href="https://loadingreadyrun.com/blog"><img src="img/navbar-blog.gif" width="61" height="16" alt="blog" /></a></li><li id="store"><a href="http://store.loadingreadyrun.com/"><img src="img/new.png" id="new_badge" /><img src="img/navbar-store.gif" width="77" height="16" alt="Store" /></a></li><li><a href="http://wiki.loadingreadyrun.com/"><img src="img/navbar-wiki.gif" width="61" height="16" alt="wiki" /></a></li><li class="last" id="forum"><a href="https://loadingreadyrun.com/forum"><img src="img/navbar-forum.gif" width="80" height="16" alt="forum" /></a></li></ul>
		 	</div>
			<div class="ProgressNotes">
				<h1>Please Note</h1>
				<h3>This is a static backup of the LRR Forums. It is unfortunately incomplete at this time, but I'm working on it</h3>
				<h5>Anaerin</h5>
			</div>
			<div class="navbar tabbed not-static" role="navigation">
				<div class="inner page-width">
					<div class="static-inner">
						<div class="nav-tabs" data-current-page="index">
							<ul class="leftside">
								<li class="tab forums selected" data-responsive-class="small-icon icon-forums" title="Forums" data-responsive-index="-1">
									<a class="nav-link" href="index.htm">Forums</a>
								</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
			<div class="navbar secondary">
				<ul role="menubar">
					<li class="small-icon icon-search responsive-cloned-item" data-clone-index="0">
						<a href="search.htm">Search</a>
					</li>
				</ul>
			</div>
			<div id="wrap" class="page-width">
				<div id="page-body" role="main">
					<div class="navbar nav-breadcrumbs">
						<ul id="nav-breadcrumbs" class="linklist navlinks" role="menubar">
							<li class="breadcrumbs small-icon icon-home" style="max-width: 850px">
								<span class="crumb" itemtype="http://data-vocabulary.org/Breadcrumb" itemscope>
									<a href="index.htm" accesskey="h" data-navbar-reference="index" itemprop="url" title="Board index">
										<span itemprop="title">Board index</span>
									</a>
								</span>
							</li>
						</ul>
					</div>
					<div class="panel">
						<div class="inner">
							<h3>Important note</h3>
							<h3>Search is implemented entirely client-side.</h3>
							<p>
								If you choose to load the search engine, it will download a ~250MB Javascript file and load it into ~4GB of RAM.
								This <strong>will</strong> take time and resources. I would recommend not doing so on a mobile phone, tablet or other
								low-power device.
							</p>
							<fieldset class="submit-buttons">
								<button id="loadIndexButton">Load search engine</button>
							</fieldset>
						</div>
					</div>
					<div class="panel bg1" id="loadProgressBarWrapper" style="display: none;">
						<div class="inner">
							<h3>Load progress</h3>
							<fieldset>
								<span id="progressText"></span>
								<progress id="loadProgress"></progress>
							</fieldset>
						</div>
					</div>
					<div class="panel bg2">
						<div class="inner">
							<h3>Search query</h3>
							<fieldset>
								<dl>
									<dt><label for="searchTerm">Search Term:</label></dt>
									<dd><input type="text" name="searchTerm" id="searchTerm" class="inputbox disabled" disabled></dd>
									<dd><label for="terms1"><input type="radio" name="terms" id="terms1" value="all" checked> Search for all terms or use query as entered</label></dd>
									<dd><label for="terms2"><input type="radio" name="terms" id="terms2" value="any"> Search for any terms</label></dd>
								</dl>
							</fieldset>
						</div>
					</div>
					<div class="panel bg1">
						<div class="inner">
							<fieldset class="submit-buttons">
								<button id="searchButton" disabled>Search</button>
							</fieldset>
							<center id="resultsString"></center>
						</div>
					</div>
					<block id="searchResultsHolder" style="display: none;">
					</block>
				</div>
			</div>
			<div>
				<a id="bottom" class="anchor" accesskey="z"></a>
			</div>
			<div id="footer" class="mobile navbar">
				<ul>
					<li class=""><a href="https://loadingreadyrun.com/m/"><i class="fa fa-home fa-lg"></i></a></li>
					<li><a href="https://loadingreadyrun.com/m/videos/archive"><i class="fa fa-film fa-lg"></i></a></li>
					<li><a href="https://loadingreadyrun.com/m/lrrcasts/archive"><i class="fa fa-headphones fa-lg"></i></a></li>
					<li><a href="https://loadingreadyrun.com/m/live"><i class="fa fa-gamepad fa-lg"></i></a></li>
					<li class="current"><a href="index.html"><i class="fa fa-comments fa-lg"></i></a></li>
				</ul>
			</div><!-- /footer -->
		</div>
		<template id="searchResultItem">
			<div class="search post panel">
				<div class="inner">
					<h3><a href="#"></a></h3>
					<dl class="postprofile">
						<dt class="author"></dt>
						<dd class="search-result-date"></dd>
						<dd class="search-result-forum">Forum: <a href="#"></a></dd>
						<dd class="search-result-topic">Topic: <a href="#"></a></dd>
						<dd class="search-result-score">Score: <span></span></dd>
					</dl>
					<div class="postbody">
						<div class="content"></div>
					</div>
				</div>
				<ul class="searchresults">
					<li>
						<a href="#" class="arrow-right"><i class="icon fa-angle-right fa-fw icon-black" aria-hidden="true"></i><span>Jump to post</span></a>
					</li>
				</ul>
			</div>
		</template>
	</body>
	<script lang="JavaScript" type="text/javascript">
		const timeZone = new Intl.DateTimeFormat("en-US", {
			dateStyle: "medium",
			timeStyle: "short",
			timeZone: "Etc/GMT-2",
			hour12: false
		});
		function formatDateTime(date) {
			const dateObj = new Date(date);
			return timeZone.format(dateObj);
		};
		const searchIndex = elasticlunr(function() {
			this.addField('page');
			this.addField('userName');
			this.addField('subject');
			this.addField('datePosted');
			this.addField('body');
			this.setRef('page');
			this.saveDocument(true);			
		});
		function batchedForEach(arr, batchSize, fn, finished) {
			let i=0;
			function partialLoop() {
				let end = Math.min(i + batchSize, arr.length);
				for (; i < end; i++) {
					fn(arr[i], i, arr);
				}
				if (i<arr.length) setTimeout(partialLoop);
				else finished.call();
			}
			partialLoop(0);
		}
		async function loadSearchIndex() {
			document.getElementById("loadIndexButton").disabled = true;
			const progressBar = document.getElementById("loadProgress");
			const progressText = document.getElementById("progressText");
			progressText.innerHTML = "Fetching search index";
			document.getElementById("loadProgressBarWrapper").style.display = "block";
			progressBar.value = 0;
			const response = await fetch("searchIndex.json");
			if (!response.ok) {
				console.error(`Unable to fetch search index: ${response.status} (${response.statusText})`);
				document.getElementById("loadProgressBarWrapper").style.display = "none";
				document.getElementById("loadIndexButton").disabled = false;
			} else {
				const result = await response.json();
				progressBar.max = result.length;
				batchedForEach(result, 500, (doc, idx) => {
					progressText.innerHTML = `Parsing search index: ${idx}/${result.length}...`;
					progressBar.value = idx;
					searchIndex.addDoc(doc);
				}, () => {
					document.getElementById("loadProgressBarWrapper").style.display = "none";
					document.getElementById("loadIndexButton").disabled = true;
					document.getElementById("searchButton").disabled = false;
					document.getElementById("searchTerm").disabled = false;
					document.getElementById("searchTerm").classList.remove("disabled");
				});
			}
		};
		async function doSearch() {
			let searchType = "AND";
			if (document.getElementById("terms2").checked) searchType="OR";
			const searchTerm = document.getElementById("searchTerm");
			const results = searchIndex.search(searchTerm.value, { operator: searchType });
			if (results.length == 0) {
				document.querySelector("block#searchResultsHolder").replaceChildren();
				document.getElementById("resultsString").textContent = `Found no results`;
			} else {
				if (results.length > 150) document.getElementById("resultsString").textContent = `Found ${results.length} results, showing first 150`;
				else document.getElementById("resultsString").textContent = `Found ${results.length} results`;
				const resultsTotal = Math.min(150, results.length);
				const newChildren = [];
				for (let i=0; i<resultsTotal; i++) {
					const result = results[i];
					const newLine = document.getElementById("searchResultItem").content.cloneNode(true);
					if (i%2) newLine.querySelector("div.search.post").classList.add("bg1");
					else newLine.querySelector("div.search.post").classList.add("bg2");
					newLine.querySelector("dt.author").innerHTML = `by ${result.doc.userName}`;
					newLine.querySelector("dd.search-result-date").innerHTML = formatDateTime(result.doc.datePosted);
					newLine.querySelector("dd.search-result-forum a").href = result.doc.forumLink;
					newLine.querySelector("dd.search-result-forum a").textContent = result.doc.forum;
					newLine.querySelector("dd.search-result-topic a").href = result.doc.threadLink;
					newLine.querySelector("dd.search-result-topic a").textContent = result.doc.thread;
					newLine.querySelector("dd.search-result-score span").textContent = result.score;
					newLine.querySelector("h3 a").href = result.doc.page;
					newLine.querySelector("ul.searchresults a").href = result.doc.page;
					if (result.doc.subject) newLine.querySelector("h3 a").textContent = result.doc.subject;
					else newLine.querySelector("h3 a").textContent = result.doc.thread;
					newLine.querySelector("div.postbody div.content").innerHTML = result.doc.body;
					newChildren.push(newLine);
				}
				document.querySelector("block#searchResultsHolder").replaceChildren(...newChildren);
			}
			document.querySelector("block#searchResultsHolder").style.display = "block";
		}
		document.getElementById("loadIndexButton").addEventListener("click", loadSearchIndex);
		document.getElementById("searchButton").addEventListener("click", doSearch);
	</script>
</html>